{% extends 'base_freelancer.html' %}
{% block title %}Assigned Projects{% endblock %}

{% block header_title %}Assigned Projects{% endblock %}
{% block header_sub %}Your active assignments{% endblock %}

{% block content %}
<section class="assigned-projects">
    <header class="section-header">
        <div>
            <h2>Assigned Projects</h2>
            <p class="muted">Detailed view of all work assigned to you.</p>
        </div>
    </header>

    {% if projects %}
    <div class="project-list">
        {% for project in projects %}
        <article class="project-card">
            <div class="card-top">
                <div class="title">{{ project.name }}</div>
                <span class="status {{ project.status|lower }}">{{ project.get_status_display }}</span>
            </div>

            <div class="row small">
                <div><strong>Startup:</strong> {{ project.startup.startup_name }}</div>
            </div>

            <div class="desc">
                {{ project.description|truncatechars:180 }}
            </div>

            <div class="info-grid">
                <div><strong>Start:</strong> {{ project.start_date|date:"d M Y" }}</div>

                {% if project.end_date %}
                <div><strong>End:</strong> {{ project.end_date|date:"d M Y" }}</div>
                {% else %}
                <div><strong>End:</strong> â€”</div>
                {% endif %}

                <div><strong>Visibility:</strong> {{ project.get_visibility_display|default:"Public" }}</div>
            </div>

            {% if project.assignment %}
            <div class="assignment-box">
                <strong>Assigned To:</strong> 
                <span class="muted">{{ project.assignment.freelancer.full_name }}</span>
                
            {% endif %}

            <div class="card-actions">
                <a href="{% url 'freelancer:freelancer_project_detail' project.id %}" class="btn btn-view">Details</a>

                {% if project.status != 'COMPLETED' and project.assignment.freelancer == request.user.freelancer_profile %}
                <form method="post" action="{% url 'freelancer:complete_project' project.id %}" onsubmit="return confirm('Mark {{ project.name }} as completed?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-complete">Complete</button>
                </form>
                {% endif %}
            </div>

        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">
        <p class="muted">No assigned projects yet.</p>
        <a href="{% url 'freelancer:available_projects' %}" class="btn btn-ghost">Browse Available Projects</a>
    </div>
    {% endif %}
</section>
{% endblock %}

{% block extra_css %}
<style>
:root{
  --primary: #1976d2;
  --muted: #6b7280;
  --border: rgba(7,32,50,0.08);
  --card-bg: #ffffff;
  --radius: 12px;
}

/* Layout */
.assigned-projects{
  max-width: 980px;
  margin: 14px auto;
  padding: 8px 12px 40px;
}

.section-header h2{
  margin-bottom: 4px;
  font-size:1.1rem;
  color:var(--primary);
  font-weight:700;
}

/* List */
.project-list{
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* NEW DETAILED CARD DESIGN */
.project-card{
  background:var(--card-bg);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:0 6px 18px rgba(16,40,80,0.04);
  transition:background .12s ease, box-shadow .12s ease;
}

.project-card:hover{
  background:#f8fbff;
}

/* Top Row */
.card-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}

.title{
  font-size:1.05rem;
  font-weight:700;
  color:var(--primary);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Filled status pill */
.status{
  padding:5px 12px;
  border-radius:20px;
  font-size:0.72rem;
  font-weight:700;
  text-transform:uppercase;
  color:#fff;
}

.status.planned{ background:#f1c40f; color:#2e2600; }
.status.ongoing{ background:linear-gradient(90deg,#2b8ef6,#1976d2); }
.status.completed{ background:linear-gradient(90deg,#27ae60,#1e8b49); }

/* Description */
.desc{
  margin:10px 0;
  font-size:0.92rem;
  color:#333;
  line-height:1.35;
}

/* Info Grid */
.info-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:6px;
  font-size:0.85rem;
  color:#444;
  margin-bottom:10px;
}

/* Assignment box */
.assignment-box{
  background:#f1f7ff;
  border:1px solid rgba(25,118,210,0.1);
  padding:8px 10px;
  border-radius:8px;
  font-size:0.86rem;
  margin-bottom:12px;
}

.assignment-box .small{font-size:0.78rem;}

/* Actions */
.card-actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top:6px;
}

.btn{
  padding:7px 10px;
  font-size:0.82rem;
  border-radius:8px;
  cursor:pointer;
  text-decoration:none;
  display:flex;
  align-items:center;
  justify-content:center;
  border:1px solid transparent;
}

/* View (outline) */
.btn-view{
  border:1px solid rgba(25,118,210,0.15);
  color:var(--primary);
  background:transparent;
}

/* Complete (filled) */
.btn-complete{
  background:var(--primary);
  color:#fff;
}

.btn-complete:hover{
  background:#1565c0;
}

/* Empty State */
.empty{
  text-align:center;
  padding:20px;
  border:1px dashed var(--border);
  border-radius:10px;
}

/* Responsive */
@media(max-width:720px){
  .info-grid{grid-template-columns:1fr;}
  .card-actions{justify-content:flex-start;}
}
</style>
{% endblock %}
